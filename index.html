<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #4361ee;
        --secondary-color: #3f37c9;
        --accent-color: #4895ef;
        --light-color: #f8f9fa;
        --dark-color: #212529;
        --success-color: #4cc9f0;
        --danger-color: #f72585;
        --warning-color: #ffbe0b;
      }

      * {
        box-sizing: border-box;
        transition: all 0.2s ease;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        margin: 0;
        padding: 20px;
        color: var(--dark-color);
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: auto;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      h2 {
        color: var(--primary-color);
        font-weight: 600;
        margin-bottom: 25px;
        position: relative;
        padding-bottom: 10px;
        text-align: center;
      }

      h2:after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 3px;
        background: var(--primary-color);
      }

      .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
        margin-bottom: 25px;
        background: var(--light-color);
        padding: 20px;
        border-radius: 8px;
      }

      .filter-group {
        display: flex;
        flex-direction: column;
        min-width: 150px;
      }

      label {
        font-size: 0.9rem;
        margin-bottom: 5px;
        font-weight: 500;
        color: var(--dark-color);
      }

      select,
      input,
      button {
        padding: 12px 15px;
        border-radius: 6px;
        border: 1px solid #ddd;
        font-size: 1rem;
      }

      select:focus,
      input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
      }

      .add-btn {
        background: var(--primary-color);
        color: white;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-weight: 500;
        margin: 20px auto;
        min-width: 200px;
      }

      .add-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
      }

      .dashboard {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 30px;
      }

      @media (max-width: 768px) {
        .dashboard {
          grid-template-columns: 1fr;
        }
      }

      .expense-list {
        background: white;
        border-radius: 8px;
        overflow: hidden;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th {
        background: var(--primary-color);
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: 500;
      }

      td {
        padding: 15px;
        border-bottom: 1px solid #eee;
      }

      tr:last-child td {
        border-bottom: none;
      }

      tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      .action-btns {
        display: flex;
        gap: 8px;
      }

      .delete-btn,
      .edit-btn {
        color: white;
        border: none;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 0.8rem;
      }

      .delete-btn {
        background: var(--danger-color);
      }

      .edit-btn {
        background: var(--accent-color);
      }

      .delete-btn:hover,
      .edit-btn:hover {
        opacity: 0.9;
        transform: scale(1.05);
      }

      .summary {
        background: var(--light-color);
        padding: 20px;
        border-radius: 8px;
        text-align: center;
      }

      .summary-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
      }

      .summary-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      }

      .summary-card h4 {
        margin: 0;
        font-size: 0.9rem;
        color: #777;
      }

      .summary-card p {
        margin: 10px 0 0;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .chart-container {
        max-width: 300px;
        max-height: 300px;
        margin: 20px auto;
      }

      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .modal-overlay.active {
        opacity: 1;
        pointer-events: all;
      }

      .modal {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 500px;
        transform: translateY(20px);
        transition: transform 0.3s ease;
      }

      .modal-overlay.active .modal {
        transform: translateY(0);
      }

      .modal h3 {
        margin-top: 0;
        color: var(--primary-color);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .modal-btn {
        padding: 12px 20px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        border: none;
      }

      .save-btn {
        background: var(--primary-color);
        color: white;
        margin-right: 10px;
      }

      .cancel-btn {
        background: #f1f1f1;
        color: #333;
      }

      .empty-state {
        text-align: center;
        padding: 30px;
        color: #777;
        display: none;
      }

      .empty-state i {
        font-size: 3rem;
        margin-bottom: 15px;
        color: #ddd;
      }

      .data-input {
        width: 100%;
        padding: 12px 15px;
        border-radius: 6px;
        border: 1px solid #ddd;
        font-size: 1rem;
      }

      .inplace-edit {
        display: flex;
        gap: 8px;
      }

      .inplace-edit input {
        flex: 1;
      }

      .currency {
        font-family: monospace;
      }

      .text-success {
        color: var(--success-color);
      }

      .text-danger {
        color: var(--danger-color);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Expense Tracker</h2>

      <div class="filters">
        <div class="filter-group">
          <label for="yearSelect"
            ><i class="fas fa-calendar-alt"></i> Year</label
          >
          <select id="yearSelect"></select>
        </div>

        <div class="filter-group">
          <label for="monthSelect"
            ><i class="fas fa-calendar-days"></i> Month</label
          >
          <select id="monthSelect">
            <option>January</option>
            <option>February</option>
            <option>March</option>
            <option>April</option>
            <option>May</option>
            <option>June</option>
            <option>July</option>
            <option>August</option>
            <option>September</option>
            <option>October</option>
            <option>November</option>
            <option>December</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="startAmount"
            ><i class="fas fa-money-bill-wave"></i> Budget (₹)</label
          >
          <input
            type="number"
            id="startAmount"
            placeholder="Enter budget amount"
            oninput="updateSummary()"
          />
        </div>
      </div>

      <button class="add-btn" onclick="openModal()">
        <i class="fas fa-plus"></i> Add New Expense
      </button>

      <div class="dashboard">
        <div class="expense-list">
          <table>
            <thead>
              <tr>
                <th>Description</th>
                <th>Amount (₹)</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="expenseTable"></tbody>
          </table>
          <div id="emptyState" class="empty-state">
            <i class="fas fa-receipt"></i>
            <p>No expenses added yet</p>
            <p>Click the "Add New Expense" button to get started</p>
          </div>
        </div>

        <div class="summary">
          <div class="summary-grid">
            <div class="summary-card">
              <h4>Total Budget</h4>
              <p class="currency">₹<span id="totalBudget">0.00</span></p>
            </div>
            <div class="summary-card">
              <h4>Total Expenses</h4>
              <p class="currency">₹<span id="totalExpenses">0.00</span></p>
            </div>
            <div class="summary-card">
              <h4>Remaining</h4>
              <p class="currency">₹<span id="savings">0.00</span></p>
            </div>
            <div class="summary-card">
              <h4>Budget Used</h4>
              <p><span id="budgetPercentage">0</span>%</p>
            </div>
          </div>

          <div class="chart-container">
            <canvas id="expenseChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
      <div class="modal">
        <h3>Add New Expense</h3>
        <div class="form-group">
          <label for="modalDesc">Description</label>
          <input
            type="text"
            id="modalDesc"
            class="data-input"
            placeholder="What did you spend on?"
          />
        </div>
        <div class="form-group">
          <label for="modalAmount">Amount (₹)</label>
          <input
            type="number"
            id="modalAmount"
            class="data-input"
            placeholder="How much did you spend?"
          />
        </div>
        <div>
          <button class="modal-btn save-btn" onclick="saveExpense()">
            <i class="fas fa-save"></i> Save
          </button>
          <button class="modal-btn cancel-btn" onclick="closeModal()">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </div>
    </div>

    <script>
      // Start of all JavaScript
      let expenses = [];
      let currentEditIndex = -1;
      let chart = null;

      // Initialize the app when page loads
      window.onload = function () {
        populateYears();
        setCurrentMonth();
        loadData();
        renderTable();
        updateSummary();
      };

      // Populate year selection from 2023 to current year + 5
      const populateYears = () => {
        const currentYear = new Date().getFullYear();
        let yearSelect = document.getElementById("yearSelect");
        yearSelect.innerHTML = "";

        for (let year = 2023; year <= currentYear + 5; year++) {
          let option = document.createElement("option");
          option.value = year;
          option.innerText = year;
          yearSelect.appendChild(option);
        }

        // Set current year as default
        yearSelect.value = currentYear;
      };

      // Initialize with current month
      const setCurrentMonth = () => {
        const months = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        document.getElementById("monthSelect").value =
          months[new Date().getMonth()];
      };

      // Modal functions
      function openModal() {
        document.getElementById("modalOverlay").classList.add("active");
        document.getElementById("modalDesc").focus();
        // Reset fields
        document.getElementById("modalDesc").value = "";
        document.getElementById("modalAmount").value = "";
        document.querySelector(".modal h3").textContent = "Add New Expense"; // Reset modal title
        currentEditIndex = -1;
      }

      function openEditModal(index) {
        const expense = expenses[index];
        document.getElementById("modalDesc").value = expense.desc;
        document.getElementById("modalAmount").value = expense.amount;
        currentEditIndex = index;
        document.querySelector(".modal h3").textContent = "Edit Expense"; // Change modal title
        document.getElementById("modalOverlay").classList.add("active"); // Show modal
      }

      function closeModal() {
        document.getElementById("modalOverlay").classList.remove("active");
      }

      function saveExpense() {
        const desc = document.getElementById("modalDesc").value.trim();
        const amount = parseFloat(
          document.getElementById("modalAmount").value.trim()
        );

        if (desc === "" || isNaN(amount) || amount <= 0) {
          alert("Please enter a valid description and amount.");
          return;
        }

        if (currentEditIndex === -1) {
          // Add new expense
          expenses.push({ desc, amount });
        } else {
          // Edit existing expense
          expenses[currentEditIndex] = { desc, amount };
        }

        saveData(); // Save to localStorage first
        closeModal(); // Then close modal
        renderTable(); // Then render table
        updateSummary(); // Then update summary
      }

      function renderTable() {
        const tableBody = document.getElementById("expenseTable");
        const emptyState = document.getElementById("emptyState");

        // Clear the table first
        tableBody.innerHTML = "";

        if (expenses.length === 0) {
          emptyState.style.display = "block";
        } else {
          emptyState.style.display = "none";

          // Populate table with expenses
          expenses.forEach((expense, index) => {
            let row = tableBody.insertRow();
            row.innerHTML = `
                <td>${expense.desc}</td>
                <td class="currency">₹${expense.amount.toFixed(2)}</td>
                <td class="action-btns">
                    <button class="edit-btn" onclick="openEditModal(${index})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="delete-btn" onclick="deleteExpense(${index})">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </td>
            `;
          });
        }
      }

      function deleteExpense(index) {
        if (confirm("Are you sure you want to delete this expense?")) {
          expenses.splice(index, 1);
          saveData();
          renderTable();
          updateSummary();
        }
      }

      function updateSummary() {
        const totalBudget =
          parseFloat(document.getElementById("startAmount").value) || 0;
        const totalExpenses = expenses.reduce(
          (sum, expense) => sum + expense.amount,
          0
        );
        const savings = totalBudget - totalExpenses;
        const budgetUsed =
          totalBudget > 0
            ? ((totalExpenses / totalBudget) * 100).toFixed(2)
            : 0;

        document.getElementById("totalBudget").textContent =
          totalBudget.toFixed(2);
        document.getElementById("totalExpenses").textContent =
          totalExpenses.toFixed(2);
        document.getElementById("savings").textContent = savings.toFixed(2);
        document.getElementById("budgetPercentage").textContent = budgetUsed;

        updateChart(totalBudget, totalExpenses, savings);
      }

      function saveData() {
        const currentYear = document.getElementById("yearSelect").value;
        const currentMonth = document.getElementById("monthSelect").value;
        const storageKey = `expenses_${currentYear}_${currentMonth}`;

        localStorage.setItem(storageKey, JSON.stringify(expenses));
      }

      function loadData() {
        const currentYear = document.getElementById("yearSelect").value;
        const currentMonth = document.getElementById("monthSelect").value;
        const storageKey = `expenses_${currentYear}_${currentMonth}`;

        const storedData = localStorage.getItem(storageKey);
        if (storedData) {
          expenses = JSON.parse(storedData);
        } else {
          expenses = [];
        }
      }

      // Add event listeners for year and month changes
      document
        .getElementById("yearSelect")
        .addEventListener("change", function () {
          loadData();
          renderTable();
          updateSummary();
        });

      document
        .getElementById("monthSelect")
        .addEventListener("change", function () {
          loadData();
          renderTable();
          updateSummary();
        });

      function updateChart(totalBudget, totalExpenses, savings) {
        const ctx = document.getElementById("expenseChart").getContext("2d");

        if (chart) {
          chart.destroy();
        }

        chart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: ["Expenses", "Remaining"],
            datasets: [
              {
                data: [totalExpenses, Math.max(0, savings)],
                backgroundColor: ["#f72585", "#4cc9f0"],
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
          },
        });
      }
    </script>
    <!-- Fix: Add closing script tag 
  </body>
</html>